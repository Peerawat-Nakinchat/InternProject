# Vault Setup ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏°

## üîÑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ Setup (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á)

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ Vault Server ‡∏Å‡∏•‡∏≤‡∏á (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ secret ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏£‡∏±‡∏ô Vault Server ‡πÄ‡∏≠‡∏á
> ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° secret ‡πÄ‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

---

## ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ Vault Server ‡∏Å‡∏•‡∏≤‡∏á (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‚úÖ)

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:

**1. ‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå credentials ‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏°:**
- `role-id` 
- `secret-id`

‡∏ß‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á 2 ‡∏•‡∏á‡πÉ‡∏ô `vault-agent-config/`

**2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `vault-agent-config/agent.hcl`:**
```hcl
vault {
  # ‡πÉ‡∏ä‡πâ IP ‡∏Ç‡∏≠‡∏á Vault Server ‡∏Å‡∏•‡∏≤‡∏á
  address = "http://172.16.12.63:8200"
}
```

**3. ‡∏£‡∏±‡∏ô Vault Agent:**
```powershell
docker compose -f docker-compose.agent.yml up -d
```

**4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:**
```powershell
docker logs vault-agent --tail 10
# ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô "authentication successful"
```

---

## ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏£‡∏±‡∏ô Vault Server ‡πÄ‡∏≠‡∏á

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:

**1. ‡∏£‡∏±‡∏ô Vault Server:**
```powershell
docker compose -f docker-compose.vault-server.yml up -d
```

**2. ‡∏£‡∏≠ Vault ‡∏û‡∏£‡πâ‡∏≠‡∏° ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ô init script:**
```powershell
Start-Sleep -Seconds 5
.\init-vault.ps1
```

**3. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `vault-agent-config/agent.hcl`:**
```hcl
vault {
  # ‡∏ä‡∏µ‡πâ‡πÑ‡∏õ localhost
  address = "http://host.docker.internal:8200"
}
```

**4. ‡∏£‡∏±‡∏ô Vault Agent:**
```powershell
docker compose -f docker-compose.agent.yml up -d
```

---

## üìã Credentials ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Server ‡∏Å‡∏•‡∏≤‡∏á

| File | Value |
|------|-------|
| role-id | `f200602c-9d34-99d0-2999-dcf8ccb32072` |
| secret-id | ‡∏Ç‡∏≠‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏° (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Git) |

## ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á

1. **‡∏≠‡∏¢‡πà‡∏≤ commit ‡πÑ‡∏ü‡∏•‡πå credentials ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Git** (‡∏ñ‡∏π‡∏Å ignore ‡πÅ‡∏•‡πâ‡∏ß)
2. **‡πÅ‡∏ä‡∏£‡πå credentials ‡∏ú‡πà‡∏≤‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢** (Slack DM, etc.)
3. **‡∏ñ‡πâ‡∏≤ credentials ‡∏´‡∏•‡∏∏‡∏î** ‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á admin ‡∏£‡∏±‡∏ô `init-vault.ps1` ‡πÉ‡∏´‡∏°‡πà

## üîß ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤

| Setting | Value | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|-------|----------|
| secret_id_ttl | 0 | ‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ |
| secret_id_num_uses | 0 | ‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î |
| token_ttl | 24h | Token ‡∏≠‡∏≤‡∏¢‡∏∏ 24 ‡∏ä‡∏°. (auto-renew) |
| token_max_ttl | 168h | Token max 7 ‡∏ß‡∏±‡∏ô |

## üåê Vault Server ‡∏Å‡∏•‡∏≤‡∏á

- **URL**: http://172.16.12.63:8200
- **UI**: http://172.16.12.63:8200/ui
- **Root Token**: `dev-root-token-123` (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)

## ‚ùì Troubleshooting

### Error: "invalid role or secret ID"
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `role-id` ‡πÅ‡∏•‡∏∞ `secret-id` ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `agent.hcl` ‡∏°‡∏µ `role = "backend-dev"`
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Vault Server ‡πÑ‡∏î‡πâ: `curl http://172.16.12.63:8200/v1/sys/health`

### Error: Connection refused
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Vault Server ‡∏£‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö IP address ‡πÉ‡∏ô `agent.hcl`
3. ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Server ‡∏Å‡∏•‡∏≤‡∏á ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ firewall ‡πÄ‡∏õ‡∏¥‡∏î port 8200
