# üñºÔ∏è Supabase Storage Integration Guide

## üìã ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç
1. [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°](#‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°)
2. [‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Supabase](#‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤-supabase)
3. [‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô API](#‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô-api)
4. [‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ](#‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ)
5. [‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢](#‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)

---

## ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ Supabase Storage ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå:

- ‚úÖ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
- ‚úÖ ‡∏•‡∏ö‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
- ‚úÖ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡∏•‡∏ö‡∏£‡∏π‡∏õ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
- ‚úÖ ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå (5MB)
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå: JPEG, PNG, GIF, WebP
- ‚úÖ ‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á: `profiles/{userId}/{uniqueFileName}`

---

## ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Supabase

### 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ Supabase

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà [https://supabase.com](https://supabase.com)
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏´‡∏£‡∏∑‡∏≠ Login
3. ‡∏Ñ‡∏•‡∏¥‡∏Å "New Project"
4. ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
   - **Project Name**: ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
   - **Database Password**: ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
   - **Region**: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏∏‡∏ì (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: Southeast Asia)
5. ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏à‡∏ô Supabase ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÄ‡∏™‡∏£‡πá‡∏à

### 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Storage Bucket

1. ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ Supabase ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π **Storage**
2. ‡∏Ñ‡∏•‡∏¥‡∏Å "**Create a new bucket**"
3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
   - **Name**: `profile-images`
   - **Public bucket**: ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î (‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ RLS - ‡∏î‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)
   - **File size limit**: 5 MB
   - **Allowed MIME types**: `image/jpeg, image/png, image/gif, image/webp`
4. ‡∏Ñ‡∏•‡∏¥‡∏Å "**Save**"

### 3. ‡∏´‡∏≤ API Credentials

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Settings** > **API**
2. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ:
   - **Project URL**: `https://xxxxx.supabase.co`
   - **API Key (anon public)**: `eyJhbGciOi...`

### 4. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏•‡∏á‡πÉ‡∏ô Environment Variables

#### ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Vault (Production)

‡∏£‡∏±‡∏ô PowerShell script ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏•‡∏á Vault:

```powershell
# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Vault token
$env:VAULT_TOKEN = "your-vault-token"

# ‡πÄ‡∏û‡∏¥‡πà‡∏° Supabase credentials
vault kv put kv/backend/supabase `
  SUPABASE_URL="https://your-project.supabase.co" `
  SUPABASE_ANON_KEY="your-anon-key-here"
```

#### ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ Vault (Development)

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `.env` ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `backend/`:

```env
# Supabase Configuration
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key-here
```

---

## ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô API

### Authentication Required
‡∏ó‡∏∏‡∏Å API ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ JWT Token ‡πÉ‡∏ô Header:
```
Authorization: Bearer <your-access-token>
```

### API Endpoints

#### 1. ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
```http
GET /api/profile
```

**Response:**
```json
{
  "success": true,
  "data": {
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "email": "user@example.com",
    "name": "John",
    "surname": "Doe",
    "profile_image_url": "https://xxxxx.supabase.co/storage/v1/object/public/profile-images/profiles/123/abc.jpg",
    ...
  }
}
```

#### 2. ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
```http
PUT /api/profile
Content-Type: application/json

{
  "name": "John",
  "surname": "Doe",
  "sex": "M",
  "user_address_1": "123 Main St",
  "user_address_2": "Apt 4B",
  "user_address_3": "Bangkok 10110"
}
```

#### 3. ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
```http
POST /api/profile/upload-image
Content-Type: multipart/form-data

profileImage: <file>
```

**Response:**
```json
{
  "success": true,
  "message": "‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
  "data": {
    "profile_image_url": "https://xxxxx.supabase.co/storage/v1/object/public/profile-images/profiles/123/abc.jpg",
    "user": { ... }
  }
}
```

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:**
- ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞: JPEG, PNG, GIF, WebP
- ‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏π‡∏õ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)

#### 4. ‡∏•‡∏ö‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
```http
DELETE /api/profile/delete-image
```

**Response:**
```json
{
  "success": true,
  "message": "‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"
}
```

---

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ

### JavaScript (Fetch API)
```javascript
// ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
const uploadProfileImage = async (file) => {
  const formData = new FormData();
  formData.append('profileImage', file);

  const response = await fetch('http://localhost:3000/api/profile/upload-image', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${accessToken}`
    },
    body: formData
  });

  return await response.json();
};

// ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
const fileInput = document.getElementById('file-input');
fileInput.addEventListener('change', async (e) => {
  const file = e.target.files[0];
  const result = await uploadProfileImage(file);
  console.log(result);
});
```

### Vue.js (Composition API)
```vue
<script setup>
import { ref } from 'vue';
import axios from 'axios';

const profileImage = ref(null);
const uploading = ref(false);

const handleFileChange = (event) => {
  profileImage.value = event.target.files[0];
};

const uploadImage = async () => {
  if (!profileImage.value) return;
  
  uploading.value = true;
  const formData = new FormData();
  formData.append('profileImage', profileImage.value);

  try {
    const { data } = await axios.post('/api/profile/upload-image', formData, {
      headers: {
        'Content-Type': 'multipart/form-data',
        'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
      }
    });
    
    console.log('Upload success:', data);
    alert('‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
  } catch (error) {
    console.error('Upload error:', error);
    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
  } finally {
    uploading.value = false;
  }
};
</script>

<template>
  <div>
    <input type="file" @change="handleFileChange" accept="image/*" />
    <button @click="uploadImage" :disabled="uploading">
      {{ uploading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î...' : '‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ' }}
    </button>
  </div>
</template>
```

### cURL
```bash
# ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ
curl -X POST http://localhost:3000/api/profile/upload-image \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "profileImage=@/path/to/image.jpg"

# ‡∏•‡∏ö‡∏£‡∏π‡∏õ
curl -X DELETE http://localhost:3000/api/profile/delete-image \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

### ‡∏£‡∏∞‡∏î‡∏±‡∏ö 1: Public Bucket (‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
- ‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÄ‡∏´‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö: ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞

**‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°** - ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢

---

### ‡∏£‡∏∞‡∏î‡∏±‡∏ö 2: Row Level Security (RLS) - ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î/‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Storage > `profile-images` > **Policies**
2. ‡∏Ñ‡∏•‡∏¥‡∏Å "**New Policy**"

#### Policy 1: ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
```sql
CREATE POLICY "Users can upload to own folder"
ON storage.objects FOR INSERT
TO authenticated
WITH CHECK (
  bucket_id = 'profile-images' AND
  (storage.foldername(name))[1] = 'profiles' AND
  (storage.foldername(name))[2] = auth.uid()::text
);
```

#### Policy 2: ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ
```sql
CREATE POLICY "Anyone can view profile images"
ON storage.objects FOR SELECT
TO public
USING (bucket_id = 'profile-images');
```

#### Policy 3: ‡∏•‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
```sql
CREATE POLICY "Users can delete own images"
ON storage.objects FOR DELETE
TO authenticated
USING (
  bucket_id = 'profile-images' AND
  (storage.foldername(name))[1] = 'profiles' AND
  (storage.foldername(name))[2] = auth.uid()::text
);
```

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ RLS ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á Supabase JWT token ‡∏î‡πâ‡∏ß‡∏¢ ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö code ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

---

### ‡∏£‡∏∞‡∏î‡∏±‡∏ö 3: Service Role Key (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Backend ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å Backend:

1. ‡πÉ‡∏ä‡πâ **Service Role Key** ‡πÅ‡∏ó‡∏ô Anon Key
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Settings > API > **Service Role Key**
3. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏ô `.env`:
```env
SUPABASE_ANON_KEY=<service-role-key>
```

‚ö†Ô∏è **‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:** Service Role Key ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏ï‡πá‡∏° ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ù‡∏±‡πà‡∏á Frontend!

---

## üìÅ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ supabase.js          # Supabase client configuration
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StorageService.js    # Service ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ upload/delete
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ uploadMiddleware.js  # Multer middleware ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProfileController.js # Controller ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
‚îÇ   ‚îî‚îÄ‚îÄ routes/
‚îÇ       ‚îî‚îÄ‚îÄ profileRoutes.js     # Routes ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö API
‚îî‚îÄ‚îÄ .env.supabase.example        # ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á env config
```

---

## üêõ Troubleshooting

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: "Supabase storage is not configured"
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ environment variables

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ `SUPABASE_URL` ‡πÅ‡∏•‡∏∞ `SUPABASE_ANON_KEY` ‡πÉ‡∏ô `.env`
2. Restart server

---

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: "Failed to upload image to storage"
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** Bucket ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á bucket ‡∏ä‡∏∑‡πà‡∏≠ `profile-images` ‡πÅ‡∏•‡πâ‡∏ß
2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ bucket ‡πÄ‡∏õ‡πá‡∏ô Public ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á RLS policies ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Key ‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

---

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏£‡∏π‡∏õ
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** Bucket ‡πÄ‡∏õ‡πá‡∏ô Private

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Storage > `profile-images`
2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ "**Public bucket**" ‡πÄ‡∏õ‡πá‡∏ô **ON**
3. ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ RLS policy ‡πÉ‡∏´‡πâ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï SELECT

---

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: "‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û"
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
- ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå .jpg, .png, .gif, .webp ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

---

## üìö ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á

- [Supabase Storage Documentation](https://supabase.com/docs/guides/storage)
- [Multer Documentation](https://github.com/expressjs/multer)
- [Supabase Storage RLS](https://supabase.com/docs/guides/storage/security/access-control)

---

## ‚úÖ Checklist ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤

- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ Supabase
- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á bucket ‡∏ä‡∏∑‡πà‡∏≠ `profile-images`
- [ ] ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Project URL ‡πÅ‡∏•‡∏∞ Anon Key
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏•‡∏á `.env` ‡∏´‡∏£‡∏∑‡∏≠ Vault
- [ ] ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ bucket ‡πÄ‡∏õ‡πá‡∏ô Public (‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á RLS)
- [ ] Restart backend server
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ

---

üéâ **‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô**
